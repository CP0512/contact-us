<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
<body class="container">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#" onclick="homePageContent()">My Website</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#" onclick="contactUsContent()" id="contactuslink">Contact Us </a>
        </li>
        <li class="nav-item" >
          <a class="nav-link" href="#" onclick="contactedUserListContent()" id="contacteduserlist">Contacted user list</a>
        </li>
      </ul>
    </div>
  </nav>
    <div class="home-page-class justify-content-center align-items-center text-center" style="height: 100%;" id="homepage">
      <h1 class="text-justify">Hi, Welcome to Chinmay Puranik's website</h1>
    </div>
    <div class="position-absolute top-50 start-50 translate-middle" id="form-contents" hidden>
    <h1 class="align-center">Contact Us</h1>
    <hr/>
    <form class="needs-validation align-center" id="form-data" novalidate>
        <div class="col-md-12">
          <label for="firstname" class="form-label">First name</label>
          <input type="text" class="form-control" id="firstname" value="" minlength="4" pattern="[a-zA-Z'-'\s]*" required>
          <div class="valid-feedback">
            Looks good!
          </div>
          <div class="invalid-feedback" id="invalid-message-firstname">
            Please provide a valid first name.
          </div>
        </div>
        <div class="col-md-12">
          <label for="lastname" class="form-label">Last name</label>
          <input type="text" class="form-control" id="lastname" value="" minlength="4" pattern="[a-zA-Z'-'\s]*" required>
          <div class="valid-feedback">
            Looks good!
          </div>
          <div class="invalid-feedback" id="invalid-message-lastname">
            Please provide a valid last name.
          </div>
        </div>
        <div class="col-md-12">
          <label for="phone" class="form-label">Phone</label>
          <input type="text" class="form-control" id="phone" value="" pattern="[7-9]{1}[0-9]{9}" required>
          <div class="valid-feedback">
            Looks good!
          </div>
          <div class="invalid-feedback" id="invalid-validation-phone">
            Please provide a valid phone.
          </div>
        </div>
        <div class="col-md-12">
          <label for="phone2" class="form-label">phone2</label>
          <input type="text" class="form-control" id="phone2" pattern="[7-9]{1}[0-9]{9}" value="" required>
          <div class="invalid-feedback" id="invalid-validation-phone2">
            Please provide a valid phone2.
          </div>
          <div class="valid-feedback">
            Looks good!
          </div>
        </div>
        <div class="col-md-12">
          <label for="address" class="form-label">Address</label>
          <input type="text" class="form-control" id="address" pattern="[a-zA-Z','\s0-9]*" required>
          <div class="invalid-feedback" id="invalid-message-address">
            Please provide a valid address.
          </div>
          <div class="valid-feedback">
            Looks good!
          </div>
        </div>
        <div class="col-md-12">
          <label for="zip" class="form-label">Zip</label>
          <input type="text" class="form-control" id="zip" pattern="[1-9]{1}[0-9]{5}" required>
          <div class="invalid-feedback" id="invalid-message-zip">
            Please provide a valid zip.
          </div>
          <div class="valid-feedback" id="valid-message-zip">
            Looks good!
          </div>
        </div>
        <br/>
        <div class="col-12">
          <button class="btn btn-primary" type="button" onclick="verifyForm()" id="send-btn">Submit form</button>
        </div>
      </form>
      <div id="form-response-message" hidden>

      </div>
      </div>
      <div id="list-of-contacted-users" hidden>
        <ul class="list-group" id="user-list">
        </ul>
    </div>
</body>
<script>


function homePageContent() {
  document.getElementById('homepage').removeAttribute("hidden")
  document.getElementById('form-contents').setAttribute("hidden","");
  document.getElementById('list-of-contacted-users').setAttribute("hidden","");
}

function contactedUserListContent(){
  document.getElementById('list-of-contacted-users').removeAttribute("hidden");
  document.getElementById('homepage').setAttribute("hidden","");
  document.getElementById('form-contents').setAttribute("hidden","");
  user_el = document.getElementById('user-list');
  var user_li_items = user_el.getElementsByTagName("li");
  for (var i = 0; i < user_li_items.length; ++i) {
        if(i !== null){
          document.getElementById('user-list-item').remove();
        }
  }
  for (let [key, value] of Object.entries(localStorage)) {
    var user_data = JSON.parse(value);
    li_el = document.createElement('li');
    li_el.setAttribute('class', 'list-group-item');
    li_el.setAttribute('id', 'user-list-item');
    li_el.innerHTML = `<h3>${user_data.first_name} ${user_data.last_name}</h3>
    <hr/>
    <ul>
    <li> <b>First Name: </b>                      ${user_data.first_name}</li>
    <li> <b>Last Name: </b>                       ${user_data.last_name}</li>
    <li> <b>Phone: </b> ${user_data.phone_number}</li>
    <li> <b>Phone2: </b> ${user_data.phone_number2}</li>  
    <li> <b>Address: </b> ${user_data.address}</li>
    <li> <b>Zip: </b> ${user_data.zip}</li>
    </ul>`;
    document.getElementById('user-list').appendChild(li_el);
   }
}

function contactUsContent() {
  document.getElementById('homepage').setAttribute("hidden","");
  document.getElementById('form-contents').removeAttribute("hidden");
  document.getElementById('list-of-contacted-users').setAttribute("hidden","");
  el_present = document.getElementById('response-message');
  if(el_present !== null){
    document.getElementById('response-message').setAttribute("hidden","");
    document.getElementById("form-data").classList.remove("was-validated");
    document.getElementById("form-data").reset();
    document.getElementById('form-data').removeAttribute("hidden");
  }
}

function verifyForm(){
  validateFields()
  const firstname = document.getElementById("firstname").value;
  const lastname = document.getElementById("lastname").value;
  const phone_number = document.getElementById("phone").value;
  const phone_number2 = document.getElementById("phone2").value;
  const address = document.getElementById("address").value;
  const zip = document.getElementById("zip").value;
  user_obj = {
    "first_name": firstname,
    "last_name": lastname,
    "phone_number": phone_number,
    "phone_number2":phone_number2,
    "address": address,
    "zip": zip
  }
  if(firstname !== "" && lastname !== "" && phone_number !== "" && phone_number2 !== "" && zip !== ""){
      if(checkAlreadyContactedUsers(phone_number+"_"+phone_number2)===true){
          localStorage.setItem(phone_number+"_"+phone_number2, JSON.stringify(user_obj))
          document.getElementById('form-data').setAttribute("hidden","");
          document.getElementById('form-response-message').removeAttribute("hidden");
          document.getElementById("form-response-message").innerHTML = "<h1 id='response-message' style='color:#198754'> Successfully Submitted </h1>";
      } else {
        document.getElementById('form-data').setAttribute("hidden","");
        document.getElementById('form-response-message').removeAttribute("hidden");
        document.getElementById("form-response-message").innerHTML = "<h1 id='response-message' style='color:red'> Your contact information is already registered with us! Thank You. </h1>";
      }
  }
}


function checkAlreadyContactedUsers(user_name){
    console.log("Inside check", localStorage.getItem(user_name))
    if(localStorage.getItem(user_name) === "" || localStorage.getItem(user_name) === null){
      return true
    } else {
      return false
    }
}

    // Example starter JavaScript for disabling form submissions if there are invalid fields
function validateFields() {
  'use strict'
  
  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  const forms = document.querySelectorAll('.needs-validation')

  // Loop over them and prevent submission
  Array.from(forms).forEach(form => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }

      form.classList.add('was-validated')
  })
}

</script>
</html>